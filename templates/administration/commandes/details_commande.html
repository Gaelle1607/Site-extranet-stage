{% extends 'administration/base_admin.html' %}

{% block title %}Détails de la commande {{ commande.numero }}{% endblock %}

{% block content %}
<!-- Conteneur principal -->
<div class="col-md-9 col-lg-10 px-md-4 py-4">

    <!-- Carte contenant les détails de la commande -->
    <div class="card">
        <div class="card-header">
            <h5 class="mb-0"><i class="bi bi-file-text"></i> Détails de la commande {{ commande.numero }}</h5>
        </div>
        <div class="card-body">
            <!-- Informations principales -->
            <div class="row">
                <div class="col-md-6">
                    <p><strong>Code Client :</strong> {{ client.tiers }}</p>
                    <p><strong>Client :</strong> {{ client.nom }}</p>
                    <p><strong>Total HT :</strong> {{ commande.total_ht|floatformat:2 }} €</p>
                </div>
                <div class="col-md-6">
                    <p><strong>Date de commande :</strong> {{ commande.date_commande|date:"d/m/Y H:i" }}</p>
                    <p><strong>Départ des camions prévue :</strong> {{ commande.date_depart_camions|date:"d/m/Y"|default:"Non définie" }}</p>
                    <p><strong>Date de livraison prévue :</strong> {{ commande.date_livraison|date:"d/m/Y"|default:"Non définie" }}</p>
                </div>
            </div>

            <!-- Commentaire optionnel -->
            {% if commande.commentaire %}
                <p><strong>Commentaire :</strong> {{ commande.commentaire }}</p>
            {% endif %}

            <!-- Articles de la commande -->
            {% if commande.lignes.all %}
                <h6>Articles</h6>
                <div style="max-height: 450px; overflow-y: auto;">
                    <table class="table table-bordered mb-0">
                        <thead style="position: sticky; top: 0; z-index: 1; background-color: var(--giffaud-gris-clair);">
                            <tr>
                                <th>Nom</th>
                                <th>Prix unitaire</th>
                                <th>Quantité</th>
                                <th>Total HT</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for ligne in commande.lignes.all %}
                                <tr>
                                    <td>{{ ligne.nom_produit }}</td>
                                    <td>{{ ligne.prix_unitaire|floatformat:2 }} €</td>
                                    <td>{{ ligne.quantite }}</td>
                                    <td>{{ ligne.total_ligne|floatformat:2 }} €</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% endif %}

        </div>
    </div>
</div>
<p><a href="{% url 'administration:liste_commande' %}" class="btn btn-outline-secondary mt-3">
    <i class="bi bi-arrow-left"></i> Retour aux commandes
</a>
</p>
<p>
<a href="{% url 'administration:commande_utilisateur' commande.utilisateur.id %}" class="btn btn-outline-secondary mt-3">
    <i class="bi bi-arrow-left"></i> Retour aux commandes de l'utilisateur
</a>
</p>
{% endblock %}
